<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>空间改造顾问</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --cream: #f5f0e8;
    --warm-white: #faf8f4;
    --sand: #e8ddc8;
    --terra: #c4956a;
    --terra-dark: #9e6e44;
    --charcoal: #2c2820;
    --gray: #8a7e72;
    --light-gray: #d4cec5;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--warm-white); color: var(--charcoal); font-family: 'DM Sans', sans-serif; font-weight: 300; min-height: 100vh; }
  header { background: var(--charcoal); padding: 28px 48px; display: flex; align-items: baseline; gap: 16px; }
  header h1 { font-family: 'Playfair Display', serif; font-size: 1.6rem; color: var(--cream); letter-spacing: 0.02em; }
  header span { font-size: 0.75rem; color: var(--terra); letter-spacing: 0.15em; text-transform: uppercase; }
  main { max-width: 1100px; margin: 0 auto; padding: 56px 32px; display: grid; grid-template-columns: 1fr 1fr; gap: 48px; align-items: start; }
  .left-panel { display: flex; flex-direction: column; gap: 24px; }
  .section-label { font-size: 0.68rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--terra); margin-bottom: 10px; }
  .upload-zone { border: 1.5px dashed var(--light-gray); border-radius: 4px; background: var(--cream); padding: 40px 24px; text-align: center; cursor: pointer; transition: all 0.3s ease; position: relative; min-height: 280px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 12px; }
  .upload-zone:hover, .upload-zone.drag-over { border-color: var(--terra); background: #f0e9da; }
  .upload-zone input[type="file"] { position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%; }
  .upload-icon { width: 48px; height: 48px; border: 1.5px solid var(--light-gray); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--gray); font-size: 1.4rem; margin-bottom: 4px; }
  .upload-zone p { color: var(--gray); font-size: 0.9rem; }
  .upload-zone small { color: var(--light-gray); font-size: 0.75rem; }
  #preview-img { width: 100%; height: 100%; object-fit: cover; border-radius: 3px; display: none; position: absolute; inset: 0; }
  .style-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
  .style-btn { padding: 10px 4px; border: 1.5px solid var(--light-gray); border-radius: 3px; background: var(--cream); font-family: 'DM Sans', sans-serif; font-size: 0.75rem; color: var(--gray); cursor: pointer; transition: all 0.2s; text-align: center; }
  .style-btn:hover { border-color: var(--terra); color: var(--terra); }
  .style-btn.active { background: var(--charcoal); border-color: var(--charcoal); color: var(--cream); }
  .budget-row { display: flex; gap: 8px; }
  .budget-btn { flex: 1; padding: 10px; border: 1.5px solid var(--light-gray); border-radius: 3px; background: var(--cream); font-family: 'DM Sans', sans-serif; font-size: 0.78rem; color: var(--gray); cursor: pointer; transition: all 0.2s; text-align: center; }
  .budget-btn:hover { border-color: var(--terra); color: var(--terra); }
  .budget-btn.active { background: var(--charcoal); border-color: var(--charcoal); color: var(--cream); }
  .analyze-btn { width: 100%; padding: 16px; background: var(--terra); border: none; border-radius: 3px; color: white; font-family: 'DM Sans', sans-serif; font-size: 0.9rem; font-weight: 500; letter-spacing: 0.05em; cursor: pointer; transition: all 0.25s; display: flex; align-items: center; justify-content: center; gap: 8px; }
  .analyze-btn:hover:not(:disabled) { background: var(--terra-dark); transform: translateY(-1px); }
  .analyze-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
  .right-panel { position: sticky; top: 32px; }
  .result-box { background: var(--cream); border-radius: 4px; min-height: 500px; padding: 32px; position: relative; overflow: hidden; }
  .placeholder-state { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; min-height: 460px; gap: 12px; color: var(--light-gray); text-align: center; }
  .placeholder-state .big-num { font-family: 'Playfair Display', serif; font-size: 5rem; color: var(--sand); line-height: 1; }
  .placeholder-state p { font-size: 0.85rem; max-width: 200px; line-height: 1.6; }
  .loading-state { display: none; flex-direction: column; align-items: center; justify-content: center; min-height: 460px; gap: 20px; }
  .spinner { width: 36px; height: 36px; border: 2px solid var(--sand); border-top-color: var(--terra); border-radius: 50%; animation: spin 0.8s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loading-state p { color: var(--gray); font-size: 0.85rem; }
  .result-content { display: none; }
  .result-section { margin-bottom: 28px; }
  .result-section h3 { font-family: 'Playfair Display', serif; font-size: 1rem; color: var(--charcoal); margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
  .result-section h3::after { content: ''; flex: 1; height: 1px; background: var(--sand); }
  .result-section p, .result-section li { font-size: 0.85rem; line-height: 1.8; color: #555; }
  .result-section ul { padding-left: 16px; }
  .result-section li { margin-bottom: 4px; }
  .tag { display: inline-block; padding: 3px 10px; background: var(--sand); border-radius: 2px; font-size: 0.72rem; color: var(--terra-dark); margin: 3px 3px 3px 0; letter-spacing: 0.05em; }
  .prompt-box { background: var(--charcoal); border-radius: 3px; padding: 16px; position: relative; }
  .prompt-box p { font-size: 0.78rem; line-height: 1.7; color: #c8bfb0; }
  .copy-btn { position: absolute; top: 10px; right: 10px; background: var(--terra); border: none; border-radius: 2px; color: white; font-size: 0.7rem; padding: 4px 10px; cursor: pointer; font-family: 'DM Sans', sans-serif; transition: background 0.2s; }
  .copy-btn:hover { background: var(--terra-dark); }
  .score-row { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 8px; }
  .score-item { flex: 1; min-width: 80px; background: white; border-radius: 3px; padding: 12px; text-align: center; }
  .score-num { font-family: 'Playfair Display', serif; font-size: 1.6rem; color: var(--terra); }
  .score-label { font-size: 0.68rem; color: var(--gray); margin-top: 2px; letter-spacing: 0.05em; }
  .error-msg { display: none; background: #fdf0ec; border-left: 3px solid #e07050; padding: 12px 16px; border-radius: 2px; font-size: 0.82rem; color: #a04020; margin-top: 12px; line-height: 1.6; }
  @media (max-width: 768px) { main { grid-template-columns: 1fr; padding: 32px 20px; } .right-panel { position: static; } header { padding: 20px 24px; } .style-row { grid-template-columns: repeat(2, 1fr); } }
</style>
</head>
<body>

<header>
  <h1>空间改造顾问</h1>
  <span>AI Interior Advisor · 无需 API Key</span>
</header>

<main>
  <div class="left-panel">

    <div>
      <div class="section-label">上传房间照片</div>
      <div class="upload-zone" id="upload-zone">
        <img id="preview-img" alt="preview" />
        <div id="upload-placeholder">
          <div class="upload-icon">⌂</div>
          <p>点击或拖拽上传照片</p>
          <small>JPG / PNG · 最大 10MB</small>
        </div>
        <input type="file" id="file-input" accept="image/*" />
      </div>
    </div>

    <div>
      <div class="section-label">目标风格</div>
      <div class="style-row">
        <button class="style-btn active" data-style="现代简约">现代简约</button>
        <button class="style-btn" data-style="北欧风">北欧风</button>
        <button class="style-btn" data-style="日式侘寂">日式侘寂</button>
        <button class="style-btn" data-style="工业风">工业风</button>
        <button class="style-btn" data-style="轻奢风">轻奢风</button>
        <button class="style-btn" data-style="中古风">中古风</button>
        <button class="style-btn" data-style="波西米亚">波西米亚</button>
        <button class="style-btn" data-style="法式复古">法式复古</button>
      </div>
    </div>

    <div>
      <div class="section-label">改造预算</div>
      <div class="budget-row">
        <button class="budget-btn active" data-budget="小预算（5000元以内）">省钱改造</button>
        <button class="budget-btn" data-budget="中等（5000-3万元）">中等预算</button>
        <button class="budget-btn" data-budget="不限预算">全面升级</button>
      </div>
    </div>

    <button class="analyze-btn" id="analyze-btn" disabled>
      <span id="btn-text">请先上传照片</span>
    </button>

    <div class="error-msg" id="error-msg"></div>
  </div>

  <div class="right-panel">
    <div class="result-box">
      <div class="placeholder-state" id="placeholder-state">
        <div class="big-num">01</div>
        <p>上传你的房间照片，开始 AI 改造分析</p>
      </div>
      <div class="loading-state" id="loading-state">
        <div class="spinner"></div>
        <p>AI 正在分析你的空间…</p>
      </div>
      <div class="result-content" id="result-content">
        <div class="result-section">
          <h3>现状评分</h3>
          <div class="score-row" id="score-row"></div>
        </div>
        <div class="result-section">
          <h3>发现的问题</h3>
          <ul id="problems-list"></ul>
        </div>
        <div class="result-section">
          <h3>改造建议</h3>
          <div id="suggestions-content"></div>
        </div>
        <div class="result-section">
          <h3>风格关键词</h3>
          <div id="keywords-content"></div>
        </div>
        <div class="result-section">
          <h3>图片生成提示词</h3>
          <div class="prompt-box">
            <p id="prompt-text"></p>
            <button class="copy-btn" id="copy-btn">复制</button>
          </div>
          <small style="color:var(--gray);font-size:0.72rem;margin-top:8px;display:block;">
            复制到 Midjourney 或 ChatGPT 即可生成效果图
          </small>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
  let selectedStyle = '现代简约';
  let selectedBudget = '小预算（5000元以内）';
  let uploadedImageBase64 = null;
  let uploadedImageType = null;

  document.querySelectorAll('.style-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.style-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      selectedStyle = btn.dataset.style;
    });
  });

  document.querySelectorAll('.budget-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.budget-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      selectedBudget = btn.dataset.budget;
    });
  });

  const fileInput = document.getElementById('file-input');
  const uploadZone = document.getElementById('upload-zone');
  const previewImg = document.getElementById('preview-img');
  const uploadPlaceholder = document.getElementById('upload-placeholder');

  uploadZone.addEventListener('dragover', (e) => { e.preventDefault(); uploadZone.classList.add('drag-over'); });
  uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('drag-over'));
  uploadZone.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadZone.classList.remove('drag-over');
    const file = e.dataTransfer.files[0];
    if (file && file.type.startsWith('image/')) handleFile(file);
  });

  fileInput.addEventListener('change', (e) => {
    if (e.target.files[0]) handleFile(e.target.files[0]);
  });

  function handleFile(file) {
    const reader = new FileReader();
    reader.onload = (e) => {
      const result = e.target.result;
      uploadedImageBase64 = result.split(',')[1];
      uploadedImageType = file.type;
      previewImg.src = result;
      previewImg.style.display = 'block';
      uploadPlaceholder.style.display = 'none';
      document.getElementById('analyze-btn').disabled = false;
      document.getElementById('btn-text').textContent = '开始 AI 分析';
    };
    reader.readAsDataURL(file);
  }

  document.getElementById('analyze-btn').addEventListener('click', analyze);

  async function analyze() {
    hideError();
    setLoading(true);

    const prompt = `你是一位专业的室内设计顾问。请分析这张房间照片，并按照以下 JSON 格式返回结果（只返回 JSON，不要其他文字，不要代码块标记）：

{
  "scores": {
    "整体布局": 数字0-10,
    "采光": 数字0-10,
    "收纳": 数字0-10,
    "美观度": 数字0-10
  },
  "problems": ["问题1", "问题2", "问题3"],
  "suggestions": [
    { "title": "建议标题", "detail": "具体说明" },
    { "title": "建议标题", "detail": "具体说明" },
    { "title": "建议标题", "detail": "具体说明" }
  ],
  "keywords": ["关键词1", "关键词2", "关键词3", "关键词4", "关键词5"],
  "midjourney_prompt": "英文Midjourney提示词，描述改造后理想效果，包含风格材质光线，约60-80词"
}

目标风格：${selectedStyle}
改造预算：${selectedBudget}`;

    try {
      const response = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'anthropic-version': '2023-06-01',
          'anthropic-dangerous-direct-browser-access': 'true'
        },
        body: JSON.stringify({
          model: 'claude-sonnet-4-20250514',
          max_tokens: 1500,
          messages: [{
            role: 'user',
            content: [
              {
                type: 'image',
                source: { type: 'base64', media_type: uploadedImageType, data: uploadedImageBase64 }
              },
              { type: 'text', text: prompt }
            ]
          }]
        })
      });

      if (!response.ok) {
        const err = await response.json().catch(() => ({}));
        throw new Error(err.error?.message || `请求失败 (${response.status})`);
      }

      const data = await response.json();
      const text = data.content[0].text.trim().replace(/```json|```/g, '').trim();
      const result = JSON.parse(text);
      renderResult(result);
    } catch (err) {
      showError('分析出错：' + err.message);
    } finally {
      setLoading(false);
    }
  }

  function renderResult(r) {
    const scoreRow = document.getElementById('score-row');
    scoreRow.innerHTML = '';
    for (const [label, val] of Object.entries(r.scores)) {
      scoreRow.innerHTML += `<div class="score-item"><div class="score-num">${val}</div><div class="score-label">${label}</div></div>`;
    }
    document.getElementById('problems-list').innerHTML = r.problems.map(p => `<li>${p}</li>`).join('');
    document.getElementById('suggestions-content').innerHTML = r.suggestions.map(s =>
      `<div style="margin-bottom:14px;"><div style="font-weight:500;font-size:0.85rem;color:var(--terra);margin-bottom:4px;">▸ ${s.title}</div><div style="font-size:0.82rem;color:#666;line-height:1.7;">${s.detail}</div></div>`
    ).join('');
    document.getElementById('keywords-content').innerHTML = r.keywords.map(k => `<span class="tag">${k}</span>`).join('');
    document.getElementById('prompt-text').textContent = r.midjourney_prompt;
    document.getElementById('placeholder-state').style.display = 'none';
    document.getElementById('result-content').style.display = 'block';
  }

  document.getElementById('copy-btn').addEventListener('click', () => {
    const text = document.getElementById('prompt-text').textContent;
    navigator.clipboard.writeText(text).then(() => {
      const btn = document.getElementById('copy-btn');
      btn.textContent = '已复制！';
      setTimeout(() => btn.textContent = '复制', 2000);
    });
  });

  function setLoading(on) {
    const btn = document.getElementById('analyze-btn');
    if (on) {
      btn.disabled = true;
      document.getElementById('btn-text').textContent = '分析中…';
      document.getElementById('loading-state').style.display = 'flex';
      document.getElementById('placeholder-state').style.display = 'none';
      document.getElementById('result-content').style.display = 'none';
    } else {
      btn.disabled = false;
      document.getElementById('btn-text').textContent = '重新分析';
      document.getElementById('loading-state').style.display = 'none';
    }
  }

  function showError(msg) {
    const el = document.getElementById('error-msg');
    el.textContent = msg;
    el.style.display = 'block';
  }

  function hideError() {
    document.getElementById('error-msg').style.display = 'none';
  }
</script>
</body>
</html>
